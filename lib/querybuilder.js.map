{"version":3,"sources":["../src/querybuilder.js"],"names":["request","require","config","curryN","merge","prop","Emitter","get","type","page","args","uri","endpoint","qs","json","then","module","exports","find","id","where","all","emitter","getEmit","items","length","forEach","trigger","c","catch","err"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,iBAAR,CAAhB;AACA,IAAMC,SAASD,QAAQ,aAAR,CAAf;;eACgCA,QAAQ,OAAR,C;IAAxBE,M,YAAAA,M;IAAQC,K,YAAAA,K;IAAOC,I,YAAAA,I;;AACvB,IAAMC,UAAUL,QAAQ,WAAR,CAAhB;;AAEA,IAAMM,MAAMJ,OAAO,CAAP,EAAU,UAACK,IAAD,EAAOC,IAAP,EAAaC,IAAb,EAAsB;AAC1C,SAAOV,QAAQ;AACbW,SAAQT,OAAOU,QAAf,SAA2BJ,IADd;AAEbK,QAAIT,MAAMM,IAAN,EAAY;AACdD;AADc,KAAZ,CAFS;AAKbK,UAAM;AALO,GAAR,EAMJC,IANI,CAMCV,KAAKG,IAAL,CAND,CAAP;AAOD,CARW,CAAZ;;AAUAQ,OAAOC,OAAP,GAAiB;AAAA,SAAS;;AAExB;AACAC,UAAM;AAAA,aAAMlB,QAAQ;AAClBW,aAAQT,OAAOU,QAAf,SAA2BJ,IAA3B,SAAmCW,EADjB;AAElBL,cAAM;AAFY,OAAR,CAAN;AAAA,KAHkB;;AAQxB;AACAM,WAAOb,IAAIC,IAAJ,EAAU,CAAV,CATiB;;AAWxB;;;;;;AAMAa,SAAK,mBAAQ;AACX,UAAMC,UAAU,IAAIhB,OAAJ,EAAhB;AACA,UAAMiB,UAAU,SAAVA,OAAU,CAACf,IAAD,EAAOC,IAAP,EAAaC,IAAb,EAAsB;AACpC,eAAOH,IAAIC,IAAJ,EAAUC,IAAV,EAAgBC,IAAhB,EACNK,IADM,CACD,iBAAS;AACb,cAAIS,MAAMC,MAAN,GAAe,CAAnB,EAAsB;AACpBD,kBAAME,OAAN,CAAc;AAAA,qBAAKJ,QAAQK,OAAR,CAAgB,MAAhB,EAAwBC,CAAxB,CAAL;AAAA,aAAd;AACA,mBAAOL,QAAQf,IAAR,EAAcC,OAAO,CAArB,EAAwBC,IAAxB,CAAP,CAFoB,CAEiB;AACtC,WAHD,MAGO;AACLY,oBAAQK,OAAR,CAAgB,KAAhB;AACD;AACF,SARM,EASNE,KATM,CASA;AAAA,iBAAOP,QAAQK,OAAR,CAAgB,OAAhB,EAAyBG,GAAzB,CAAP;AAAA,SATA,CAAP;AAUD,OAXD;AAYAP,cAAQf,IAAR,EAAc,CAAd,EAAiBE,IAAjB;;AAEA,aAAOY,OAAP;AACD;;AAlCuB,GAAT;AAAA,CAAjB","file":"querybuilder.js","sourcesContent":["const request = require('request-promise')\nconst config = require('./config.js')\nconst { curryN, merge, prop } = require('ramda')\nconst Emitter = require('emitter20')\n\nconst get = curryN(3, (type, page, args) => {\n  return request({\n    uri: `${config.endpoint}/${type}`,\n    qs: merge(args, {\n      page\n    }),\n    json: true\n  }).then(prop(type))\n})\n\nmodule.exports = type => ({\n\n  /** Gets a resource by its id. */\n  find: id => request({\n    uri: `${config.endpoint}/${type}/${id}`,\n    json: true\n  }),\n\n  /** Gets a resource with a given query. */\n  where: get(type, 0),\n\n  /** Gets a resource with a given query (like where), but\n      returns an emitter that emits 3 events:\n      - data(card): emits a card when it is retrieved from the API\n      - error(err): emits an error if the request fails\n      - end(): called when all results have been retrieved\n  */\n  all: args => {\n    const emitter = new Emitter()\n    const getEmit = (type, page, args) => {\n      return get(type, page, args)\n      .then(items => {\n        if (items.length > 0) {\n          items.forEach(c => emitter.trigger('data', c))\n          return getEmit(type, page + 1, args) // RECURSION\n        } else {\n          emitter.trigger('end')\n        }\n      })\n      .catch(err => emitter.trigger('error', err))\n    }\n    getEmit(type, 1, args)\n\n    return emitter\n  }\n\n})\n"]}